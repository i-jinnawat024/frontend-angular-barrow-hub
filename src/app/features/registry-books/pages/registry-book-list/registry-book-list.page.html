<div class="container-fluid mx-auto px-4 py-8">
  <!-- Header -->
  <div class="mb-4 flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold text-primary">เล่มทะเบียน</h1>
      <p class="mt-2 text-secondary">จัดการรายการเล่มทะเบียนทั้งหมดในระบบ</p>
    </div>
    <button
      type="button"
      class="btn-primary cursor-pointer"
      mat-button
      (click)="createRegistryBook()"
    >
      <mat-icon style="font-size: 18px; width: 18px; height: 18px">add</mat-icon>
      @if (this.isDesktopView()) {
        <span style="margin-left: 4px">เพิ่มเล่มทะเบียน</span>
      }
    </button>
  </div>

  <!-- Registry Books Table -->
  <div class="bg-surface rounded-lg shadow border border-subtle overflow-hidden mt-4">
       <div class="border-b border-subtle bg-surface-alt px-4 py-4">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
        <div class="relative w-full sm:w-80">
          <div class="pointer-events-none absolute inset-y-0 start-0 flex items-center ps-3">
            <mat-icon class="text-secondary text-base">search</mat-icon>
          </div>
          <input
            type="search"
            class="form-control w-full ps-10 pe-10"
            placeholder="ค้นหาเล่มทะเบียน"
            autocomplete="off"
            [value]="searchTerm()"
            (input)="onSearchTermChange($event)"
          />
          @if (hasSearchTerm()) {
            <button
              type="button"
              class="table-search-clear"
              (click)="clearSearch()"
              aria-label="ล้างการค้นหา"
            >
              <mat-icon class="text-secondary text-base">close</mat-icon>
            </button>
          }
        </div>
      </div>
    </div>
    <div class="overflow-x-auto">
      @if (filteredRegistryBooks().length > 0) {
        <table class="w-full text-sm text-left rtl:text-right text-secondary">
          <thead class="bg-table-header text-xs uppercase text-secondary">
            <tr>
              @for (column of columns; track column.property) {
                <th scope="col" class="px-6 py-3">
                  @if (column.sortable) {
                    <button
                      type="button"
                      class="table-sort-button"
                      (click)="toggleSort(column.property)"
                      [attr.aria-sort]="
                        isSortedAscending(column.property)
                          ? 'ascending'
                          : isSortedDescending(column.property)
                          ? 'descending'
                          : 'none'
                      "
                    >
                      <span>{{ column.label }}</span>
                      <mat-icon class="table-sort-icon">
                        @if (isSortedAscending(column.property)) {
                          arrow_upward
                        } @else if (isSortedDescending(column.property)) {
                          arrow_downward
                        } @else {
                          unfold_more
                        }
                      </mat-icon>
                    </button>
                  } @else {
                    <span class="table-header-label">{{ column.label }}</span>
                  }
                </th>
              }
            </tr>
          </thead>
          <tbody>
            @for (book of filteredRegistryBooks(); track book.id) {
              <tr class="bg-surface transition hover:bg-surface-hover">
                <th scope="row" class="px-6 py-4 font-medium text-secondary">
                  {{ book.bookNumber }}
                </th>
                <td class="px-6 py-4">
                  {{ book.name }}
                </td>
                <td class="px-6 py-4">
                  @switch (book.status) {
                    @case ('active') {
                      <span class="badge badge-success"> พร้อมใช้งาน </span>
                    }
                    @case ('borrowed') {
                      <span class="badge badge-warning"> กำลังยืม </span>
                    }
                    @case ('archived') {
                      <span class="badge badge-neutral"> เก็บถาวร </span>
                    }
                    @default {
                      <span class="badge badge-alert" style="background-color: #dc3545; color: white">
                        ไม่ทราบสถานะ
                      </span>
                    }
                  }
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  <div class="flex items-center gap-2">
                    <button
                      type="button"
                      class="text-link hover:text-link-strong cursor-pointer"
                      (click)="viewDetails(book.id)"
                      title="ดูรายละเอียด"
                    >
                      <mat-icon
                        class="material-symbols-outlined"
                        style="font-size: 20px; width: 18px; height: 18px"
                      >
                        visibility
                      </mat-icon>
                    </button>
                    <button
                      type="button"
                      class="text-success hover:text-success-strong cursor-pointer"
                      (click)="editRegistryBook(book.id)"
                      title="แก้ไข"
                    >
                      <mat-icon
                        class="material-symbols-outlined"
                        style="font-size: 20px; width: 18px; height: 18px"
                      >
                        edit_document
                      </mat-icon>
                    </button>
                    <button
                      type="button"
                      class="text-danger hover:text-danger-strong cursor-pointer"
                      (click)="deleteRegistryBook(book.id)"
                      title="ลบ"
                    >
                      <mat-icon
                        class="material-symbols-outlined"
                        style="font-size: 20px; width: 18px; height: 18px"
                      >
                        delete
                      </mat-icon>
                    </button>
                  </div>
                </td>
              </tr>
            }
          </tbody>
        </table>
      } @else if (registryBookCount() === 0 && !hasSearchTerm()) {
        <div class="p-12 text-center">
          <svg
            class="mx-auto h-12 w-12 text-muted"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"
            ></path>
          </svg>
          <h3 class="mt-2 text-sm font-medium text-primary">ยังไม่มีเล่มทะเบียน</h3>
          <p class="mt-1 text-sm text-muted">เพิ่มเล่มทะเบียนแรกเพื่อเริ่มจัดการข้อมูล</p>
        </div>
      } @else {
        <div class="p-12 text-center">
          <mat-icon class="material-symbols-outlined text-muted" style="font-size: 48px">
            search_off
          </mat-icon>
          <h3 class="mt-2 text-sm font-medium text-primary">ไม่พบรายการที่ค้นหา</h3>
          <p class="mt-1 text-sm text-muted">กรุณาปรับคำค้นหรือเงื่อนไขแล้วลองอีกครั้ง</p>
        </div>
      }
    </div>
  </div>
</div>